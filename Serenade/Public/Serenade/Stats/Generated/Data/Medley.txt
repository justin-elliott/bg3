new entry "Serenade_Medley"
type "SpellData"
data "SpellType" "Shout"
using "Shout_SongOfRest"
data "AreaRadius" "9"
data "Cooldown" ""
data "DisplayName" "Serenade_Medley_DisplayName"
data "Description" "Serenade_Medley_Description"
data "Icon" "Action_Song_SingForMe"
data "Level" "0"
data "SpellProperties" "ApplyStatus(SERENADE_AID,100,-1);ApplyStatus(SERENADE_RECOVERY,100,-1);ApplyStatus(DARKVISION,100,-1);ApplyStatus(LONGSTRIDER,100,-1);IF(not WearingArmor()):ApplyStatus(MAGE_ARMOR,100,-1);ApplyStatus(PETPAL,100,-1)"
data "TargetConditions" "Character() and Ally()"

new entry "SERENADE_AID"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Serenade_Aid_DisplayName"
data "Description" "Serenade_Aid_Description"
data "DescriptionParams" "LevelMapValue(Serenade_AidValue);RegainHitPoints(1d4)"
data "Icon" "Spell_Abjuration_Aid"
data "StackId" "AID"
data "Boosts" "IncreaseMaxHP(LevelMapValue(Serenade_AidValue))"
data "TickType" "StartTurn"
data "TickFunctors" "IF(HasHPPercentageLessThan(100)):RegainHitPoints(1d4)"
data "StatusGroups" "SG_RemoveOnRespec"

new entry "SERENADE_RECOVERY"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Serenade_Recovery_DisplayName"
data "Description" "Serenade_Recovery_Description"
data "Icon" "Skill_Wizard_ArcaneRecovery"
data "Passives" "Serenade_Recovery_1;Serenade_Recovery_2;Serenade_Recovery_3;Serenade_Recovery_4;Serenade_Recovery_5;Serenade_Recovery_6"
data "StackId" "SERENADE_RECOVERY"
data "StackType" "Overwrite"
data "StatusGroups" "SG_RemoveOnRespec"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog"

new entry "SERENADE_RECOVERING"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Serenade_Recovery_DisplayName"
data "Description" "Serenade_Recovery_Description"
data "Icon" "Skill_Wizard_ArcaneRecovery"
data "OnRemoveFunctors" "IF(RemoveCause(StatusRemoveCause.TimeOut) and IsFirstUsedSpellSlot(6)):RestoreResource(SpellSlot,1,6);IF(RemoveCause(StatusRemoveCause.TimeOut) and IsFirstUsedSpellSlot(5)):RestoreResource(SpellSlot,1,5);IF(RemoveCause(StatusRemoveCause.TimeOut) and IsFirstUsedSpellSlot(4)):RestoreResource(SpellSlot,1,4);IF(RemoveCause(StatusRemoveCause.TimeOut) and IsFirstUsedSpellSlot(3)):RestoreResource(SpellSlot,1,3);IF(RemoveCause(StatusRemoveCause.TimeOut) and IsFirstUsedSpellSlot(2)):RestoreResource(SpellSlot,1,2);IF(RemoveCause(StatusRemoveCause.TimeOut) and IsFirstUsedSpellSlot(1)):RestoreResource(SpellSlot,1,1)"
data "StackId" "SERENADE_RECOVERING"
data "StackType" "Overwrite"
data "StatusGroups" "SG_RemoveOnRespec"
data "StatusPropertyFlags" "DisableOverhead;DisablePortraitIndicator;DisableCombatlog"

new entry "Serenade_Recovery_1"
type "PassiveData"
data "Properties" "IsHidden"
data "StatsFunctorContext" "OnCreate;OnActionResourcesChanged"
data "StatsFunctors" "IF(CanRecoverSpellSlot(1,'SERENADE_RECOVERING')):ApplyStatus(SERENADE_RECOVERING,100,1)"

new entry "Serenade_Recovery_2"
type "PassiveData"
data "Properties" "IsHidden"
data "StatsFunctorContext" "OnCreate;OnActionResourcesChanged"
data "StatsFunctors" "IF(CanRecoverSpellSlot(2,'SERENADE_RECOVERING')):ApplyStatus(SERENADE_RECOVERING,100,2)"

new entry "Serenade_Recovery_3"
type "PassiveData"
data "Properties" "IsHidden"
data "StatsFunctorContext" "OnCreate;OnActionResourcesChanged"
data "StatsFunctors" "IF(CanRecoverSpellSlot(3,'SERENADE_RECOVERING')):ApplyStatus(SERENADE_RECOVERING,100,3)"

new entry "Serenade_Recovery_4"
type "PassiveData"
data "Properties" "IsHidden"
data "StatsFunctorContext" "OnCreate;OnActionResourcesChanged"
data "StatsFunctors" "IF(CanRecoverSpellSlot(4,'SERENADE_RECOVERING')):ApplyStatus(SERENADE_RECOVERING,100,4)"

new entry "Serenade_Recovery_5"
type "PassiveData"
data "Properties" "IsHidden"
data "StatsFunctorContext" "OnCreate;OnActionResourcesChanged"
data "StatsFunctors" "IF(CanRecoverSpellSlot(5,'SERENADE_RECOVERING')):ApplyStatus(SERENADE_RECOVERING,100,5)"

new entry "Serenade_Recovery_6"
type "PassiveData"
data "Properties" "IsHidden"
data "StatsFunctorContext" "OnCreate;OnActionResourcesChanged"
data "StatsFunctors" "IF(CanRecoverSpellSlot(6,'SERENADE_RECOVERING')):ApplyStatus(SERENADE_RECOVERING,100,6)"
